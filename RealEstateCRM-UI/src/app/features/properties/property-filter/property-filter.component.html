<mat-expansion-panel class="filter-panel"
                     [expanded]="isFilterOpen"
                     (opened)="isFilterOpen = true"
                     (closed)="isFilterOpen = false">

  <mat-expansion-panel-header>
    <mat-panel-title>
      Advanced Filters
      <mat-chip *ngIf="activeFiltersCount > 0" class="filter-badge">
        {{ activeFiltersCount }}
      </mat-chip>
    </mat-panel-title>
  </mat-expansion-panel-header>

  <form [formGroup]="filterForm" class="filter-form">
    <div class="filter-section">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Search</mat-label>
        <input matInput formControlName="searchTerm" placeholder="Search by title or description">
      </mat-form-field>
    </div>

    <div class="filter-section">
      <h4>Price Range (TRY)</h4>
      <div class="range-inputs">
        <mat-form-field appearance="outline">
          <mat-label>Min Price</mat-label>
          <input matInput type="number" formControlName="minPrice" placeholder="0">
          <span matPrefix>&nbsp; ₺ &nbsp;</span>
        </mat-form-field>
        <span class="range-separator">-</span>
        <mat-form-field appearance="outline">
          <mat-label>Max Price</mat-label>
          <input matInput type="number" formControlName="maxPrice" placeholder="10,000,000">
          <span matPrefix>&nbsp;₺&nbsp;</span>
        </mat-form-field>
      </div>
    </div>

    <div class="filter-section">
      <h4>Area (m²)</h4>
      <div class="range-inputs">
        <mat-form-field appearance="outline">
          <mat-label>Min Area</mat-label>
          <input matInput type="number" formControlName="minArea" placeholder="0">
          <span matSuffix>&nbsp;m²&nbsp;</span>
        </mat-form-field>
        <span class="range-separator">-</span>
        <mat-form-field appearance="outline">
          <mat-label>Max Area</mat-label>
          <input matInput type="number" formControlName="maxArea" placeholder="1000">
          <span matSuffix>&nbsp;m²&nbsp;</span>
        </mat-form-field>
      </div>
    </div>

    <div class="filter-section">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>City</mat-label>
        <mat-select formControlName="city">
          <mat-option value="">All Cities</mat-option>
          <mat-option *ngFor="let city of cities" [value]="city">
            {{ city }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="filter-section">
      <h4>Property Type</h4>
      <div class="checkbox-group">
        <mat-checkbox *ngFor="let type of propertyTypes"
                      [checked]="isTypeSelected(type.id)"
                      (change)="onTypeChange(type.id, $event.checked)">
          {{ type.name }}
        </mat-checkbox>
      </div>
    </div>

    <div class="filter-section">
      <h4>Category</h4>
      <div class="checkbox-group">
        <mat-checkbox *ngFor="let category of propertyCategories"
                      [checked]="isCategorySelected(category.id)"
                      (change)="onCategoryChange(category.id, $event.checked)">
          {{ category.name }}
        </mat-checkbox>
      </div>
    </div>

    <div class="filter-section">
      <div class="two-columns">
        <mat-form-field appearance="outline">
          <mat-label>Rooms</mat-label>
          <mat-select formControlName="roomCount">
            <mat-option [value]="null">Any</mat-option>
            <mat-option *ngFor="let room of roomOptions" [value]="room">
              {{ room }}{{ room === 6 ? '+' : '' }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Bathrooms</mat-label>
          <mat-select formControlName="bathroomCount">
            <mat-option [value]="null">Any</mat-option>
            <mat-option *ngFor="let bath of bathroomOptions" [value]="bath">
              {{ bath }}{{ bath === 5 ? '+' : '' }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div class="filter-section">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Status</mat-label>
        <mat-select formControlName="isActive">
          <mat-option [value]="null">All</mat-option>
          <mat-option [value]="true">Active</mat-option>
          <mat-option [value]="false">Inactive</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="filter-actions">
      <button mat-raised-button type="button" (click)="clearFilters()">
        Clear Filters
      </button>
      <button mat-raised-button color="primary" type="button" (click)="applyFilters()">
        Apply Filters
      </button>
    </div>
  </form>
</mat-expansion-panel>
